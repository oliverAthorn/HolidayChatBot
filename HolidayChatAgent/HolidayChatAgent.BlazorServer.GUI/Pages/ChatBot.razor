@page "/ChatBot"

@using HolidayChatAgent.Services
@using HolidayChatAgent.Services.Interfaces
@using HolidayChatAgent.Repository
@using HolidayChatAgent.Repository.Models
@using HolidayChatAgent.Repository.Data.Connection

@inject IHolidayService _service

<h1>Holiday Chat Agent</h1>

<EditForm Model="@preferences" OnValidSubmit="@SavePreferences">

    @if(QuestionTracker == 0)
    {
      <p>Welcome to Chat Bot! First of all, do you like a hot or cold holiday?</p>
      <InputText id="Category" @bind-Value="preferences.Category"/>  
    }
    
     @if(QuestionTracker == 1)
    {
      <p>Thank you! Next, can you tell me what your preffered price per night is?</p>
      <InputText id="PricePerNight" @bind-Value="preferences.PricePerNight"/>
    }
    
    <button type="submit" class="btn btn-primary">Submit</button>

</EditForm>


@if (holidays is null)
{
        <><em>Loading...</em></>
}
else
{
<table class="table table-striped">
    <thead>
        <tr>
            <th>HolidayReference </th>
            <th>HotelName        </th>
            <th>City             </th>
            <th>Continent        </th>
            <th>Country          </th>
            <th>Category         </th>
            <th>StarRating       </th>
            <th>TempRating       </th>
            <th>Location         </th>
            <th>PricePerNight    </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var holiday in holidays)
        {
            <tr>
                <td>@holiday.HolidayReference</td>
                <td>@holiday.HotelName</td>
                <td>@holiday.City</td>
                <td>@holiday.Continent</td>
                <td>@holiday.Country</td>
                <td>@holiday.Category</td>
                <td>@holiday.StarRating</td>
                <td>@holiday.TempRating</td>
                <td>@holiday.Location</td>
                <td>@holiday.PricePerNight</td>
            </tr>
        }
    </tbody>
</table>
}

@code {
    private PreferenceCalculator preferenceCalculator = new PreferenceCalculator();
    private List<Holiday> holidays;
    private UserPreferences preferences = new UserPreferences();
    private int QuestionTracker = 0;

    protected override async Task OnInitializedAsync()
    {
        {
            holidays = await _service.GetAllHolidaysAsync();
        }
    }

    private void SavePreferences()
    {
        QuestionTracker++;

        preferenceCalculator.Category = preferences.Category;
        preferenceCalculator.PricePerNight = preferences.PricePerNight;

        if(preferenceCalculator.Category == "hot")
        {
            holidays.RemoveAll(x => x.TempRating == "cold");

        }
    }
}